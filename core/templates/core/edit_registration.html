{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Registration - Admin - ARTIFA FEST{% endblock %}

{% block extra_css %}
<style>
    /* Stranger Things Theme - Consistent Color System */
    :root {
        --background: 0 0% 2%;
        --foreground: 0 0% 96%;
        --card: 0 0% 7%;
        --card-foreground: 0 0% 96%;
        --primary: 0 92% 48%;
        --primary-foreground: 0 0% 100%;
        --secondary: 220 22% 14%;
        --secondary-foreground: 0 0% 96%;
        --muted: 220 18% 18%;
        --muted-foreground: 220 12% 65%;
        --accent: 220 94% 58%;
        --accent-foreground: 0 0% 100%;
        --border: 220 18% 22%;
        --ring: 0 92% 48%;
        
        /* Stranger Things Enhanced Colors */
        --stranger-red: 0 92% 48%;
        --stranger-red-glow: 0 100% 55%;
        --stranger-dark: 0 0% 2%;
        --stranger-blue: 220 94% 58%;
        --stranger-fog: 220 24% 55%;
        --upside-down-bg: 180 35% 4%;
        --upside-down-red: 0 100% 35%;
        --stranger-yellow: 45 98% 80%;
        --stranger-orange: 25 96% 56%;
        --stranger-purple: 280 86% 62%;
        --stranger-green: 160 84% 39%;
        
        /* Enhanced Gradients */
        --gradient-dark: linear-gradient(180deg, 
            hsl(0 0% 2%) 0%, 
            hsl(220 22% 8%) 30%, 
            hsl(0 0% 2%) 100%);
        --gradient-card: linear-gradient(145deg, 
            hsl(0 0% 7%) 0%, 
            hsl(220 18% 10%) 100%);
        --gradient-btn-primary: linear-gradient(135deg, 
            hsl(0 92% 48%) 0%, 
            hsl(0 100% 45%) 50%, 
            hsl(0 92% 48%) 100%);
        
        /* Shadows */
        --shadow-card: 0 8px 32px hsl(0 0% 0% / .5);
        --shadow-card-hover: 0 16px 48px hsl(0 92% 48% / .25);
        --shadow-btn: 0 4px 15px hsl(0 92% 48% / .3);
    }

    body {
        padding-top: 0 !important;
        background: hsl(var(--background)) !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    main {
        position: relative;
        z-index: 10;
        padding-top: 210px;
    }

    /* Header Section */
    .edit-registration-hero {
        position: relative;
        padding: 80px 0 40px;
        background: linear-gradient(45deg, 
            hsl(var(--stranger-dark) / 0.1), 
            hsl(var(--secondary) / 0.1),
            hsl(var(--stranger-dark) / 0.1));
        color: hsl(var(--foreground));
        overflow: hidden;
        text-align: center;
        border-bottom: 3px solid hsl(var(--primary));
    }

    .edit-registration-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 50%, hsl(var(--primary) / 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, hsl(var(--accent) / 0.1) 0%, transparent 50%);
    }

    .edit-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 3.5rem;
        font-weight: 900;
        background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--stranger-yellow)));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 15px;
        text-shadow: 0 0 30px hsl(var(--primary) / 0.3);
        text-transform: uppercase;
        letter-spacing: 3px;
    }

    .edit-subtitle {
        font-size: 1.4rem;
        color: hsl(var(--stranger-yellow));
        opacity: 0.9;
    }

    /* Content Area */
    .edit-content {
        padding: 60px 0;
        background: hsl(var(--background));
        position: relative;
        z-index: 10;
    }

    /* Form Container */
    .form-container {
        max-width: 900px;
        margin: 0 auto;
    }

    /* Back Link */
    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        color: hsl(var(--stranger-yellow));
        text-decoration: none;
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 30px;
        padding: 10px 20px;
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        background: hsl(var(--secondary) / 0.3);
        transition: all 0.3s ease;
    }

    .back-link:hover {
        color: hsl(var(--primary));
        border-color: hsl(var(--primary));
        background: hsl(var(--secondary) / 0.5);
        transform: translateX(-5px);
    }

    /* Form Section */
    .form-section {
        background: var(--gradient-card);
        border: 2px solid hsl(var(--border));
        border-radius: 20px;
        padding: 40px;
        position: relative;
        overflow: hidden;
        animation: slideInUp 0.6s ease-out;
    }

    .form-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, hsl(var(--primary)), hsl(var(--stranger-orange)));
    }

    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Section Headers */
    .section-header {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.8rem;
        font-weight: 700;
        color: hsl(var(--primary));
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid hsl(var(--primary) / 0.3);
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .section-header i {
        font-size: 2rem;
        filter: drop-shadow(0 0 8px hsl(var(--primary) / 0.5));
    }

    /* Form Grid */
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }

    /* Form Groups */
    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        font-weight: 600;
        color: hsl(var(--foreground));
        margin-bottom: 10px;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Form Controls */
    .form-control, .form-select {
        width: 100%;
        padding: 14px 16px;
        background: hsl(var(--secondary) / 0.3);
        border: 2px solid hsl(var(--border));
        border-radius: 10px;
        color: hsl(var(--foreground));
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        outline: none;
        border-color: hsl(var(--primary));
        box-shadow: 0 0 0 3px hsl(var(--primary) / 0.1);
        background: hsl(var(--secondary) / 0.5);
    }

    /* Switch Styles */
    .form-switch-container {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: hsl(var(--secondary) / 0.2);
        border: 2px solid hsl(var(--border));
        border-radius: 10px;
        margin-bottom: 15px;
    }

    .form-check-input {
        width: 60px !important;
        height: 30px !important;
        background-color: hsl(var(--border)) !important;
        border-color: hsl(var(--border)) !important;
    }

    .form-check-input:checked {
        background-color: hsl(var(--primary)) !important;
        border-color: hsl(var(--primary)) !important;
    }

    .form-check-label {
        color: hsl(var(--foreground));
        font-weight: 600;
        cursor: pointer;
        font-size: 1rem;
    }

    /* Button Group */
    .button-group {
        display: flex;
        gap: 20px;
        justify-content: flex-end;
        margin-top: 40px;
        padding-top: 30px;
        border-top: 2px solid hsl(var(--border) / 0.3);
        flex-wrap: wrap;
    }

    .btn {
        padding: 14px 30px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
    }

    .btn-primary {
        background: var(--gradient-btn-primary);
        color: hsl(var(--primary-foreground));
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-btn);
    }

    .btn-secondary {
        background: transparent;
        color: hsl(var(--foreground));
        border: 2px solid hsl(var(--border));
    }

    .btn-secondary:hover {
        border-color: hsl(var(--primary));
        background: hsl(var(--primary) / 0.1);
        transform: translateY(-3px);
    }

    /* Alert Messages */
    .alert {
        background: hsl(var(--secondary) / 0.3);
        border: 2px solid;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        color: hsl(var(--foreground));
    }

    .alert-success {
        border-color: hsl(var(--stranger-green));
        background: hsl(var(--stranger-green) / 0.1);
    }

    .alert-danger {
        border-color: hsl(var(--primary));
        background: hsl(var(--primary) / 0.1);
    }

    /* Info Box */
    .info-box {
        background: hsl(var(--secondary) / 0.3);
        border: 2px solid hsl(var(--stranger-yellow) / 0.3);
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
    }

    .info-title {
        font-weight: 700;
        color: hsl(var(--stranger-yellow));
        margin-bottom: 10px;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .info-content {
        color: hsl(var(--muted-foreground));
        line-height: 1.6;
        font-size: 0.95rem;
    }

    /* Error Display */
    .error-list {
        background: hsl(var(--primary) / 0.1);
        border: 1px solid hsl(var(--primary));
        border-radius: 8px;
        padding: 15px;
        margin-top: 10px;
        font-size: 0.9rem;
        color: hsl(0 92% 60%);
    }

    /* Responsive Design */
    @media (max-width: 992px) {
        .edit-title {
            font-size: 2.5rem;
        }

        .section-header {
            font-size: 1.5rem;
        }

        .form-section {
            padding: 30px;
        }

        .form-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .button-group {
            justify-content: stretch;
        }

        .btn {
            flex: 1;
            justify-content: center;
        }
    }

    @media (max-width: 768px) {
        main {
            padding-top: 180px;
        }

        .edit-registration-hero {
            padding: 60px 0 30px;
        }

        .edit-title {
            font-size: 2rem;
            letter-spacing: 2px;
        }

        .section-header {
            font-size: 1.3rem;
        }

        .form-section {
            padding: 25px;
        }

        .button-group {
            flex-direction: column;
        }

        .btn {
            width: 100%;
        }

        .form-control,
        .form-select {
            padding: 12px 14px;
        }
    }

    @media (max-width: 576px) {
        .edit-title {
            font-size: 1.8rem;
        }

        .edit-subtitle {
            font-size: 1.1rem;
        }

        .form-section {
            padding: 20px;
        }

        .section-header {
            font-size: 1.1rem;
            gap: 10px;
        }

        .section-header i {
            font-size: 1.8rem;
        }

        .form-label {
            font-size: 0.85rem;
        }

        .btn {
            padding: 12px 20px;
            font-size: 0.9rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="edit-registration-hero">
    <div class="container">
        <h1 class="edit-title">
            <i class="fas fa-user-edit"></i> Edit Registration
        </h1>
        <p class="edit-subtitle">Update participant registration details</p>
    </div>
</section>

<!-- Main Content -->
<section class="edit-content">
    <div class="container">
        <div class="form-container">
            <!-- Back Link -->
            <a href="{% url 'view_registrations' %}" class="back-link">
                <i class="fas fa-arrow-left"></i> Back to Registrations
            </a>

            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'danger' %}exclamation-circle{% elif message.tags == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Edit Form -->
            <form method="POST" class="form-section">
                {% csrf_token %}
                
                <!-- Personal Information Section -->
                <h2 class="section-header">
                    <i class="fas fa-user-circle"></i> Personal Information
                </h2>

                <div class="form-grid">
                    <!-- Full Name -->
                    <div class="form-group">
                        <label for="id_full_name" class="form-label">Full Name *</label>
                        <input type="text" name="full_name" id="id_full_name" class="form-control" 
                               value="{{ registration.full_name }}" required placeholder="Enter full name">
                    </div>

                    <!-- Register Number -->
                    <div class="form-group">
                        <label for="id_register_number" class="form-label">Register Number *</label>
                        <input type="text" name="register_number" id="id_register_number" class="form-control" 
                               value="{{ registration.register_number }}" required placeholder="e.g., 21AID001">
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="id_email" class="form-label">Email Address *</label>
                        <input type="email" name="email" id="id_email" class="form-control" 
                               value="{{ registration.email }}" required placeholder="student@example.com">
                    </div>

                    <!-- Phone Number -->
                    <div class="form-group">
                        <label for="id_phone_number" class="form-label">Phone Number</label>
                        <input type="tel" name="phone_number" id="id_phone_number" class="form-control" 
                               value="{{ registration.phone_number }}" placeholder="+91 9876543210">
                    </div>

                    <!-- Year -->
                    <div class="form-group">
                        <label for="id_year" class="form-label">Year *</label>
                        <select name="year" id="id_year" class="form-select" required>
                            <option value="">-- Select Year --</option>
                            {% for code, label in year_choices %}
                                <option value="{{ code }}" {% if code == registration.year %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Department -->
                    <div class="form-group">
                        <label for="id_department" class="form-label">Department *</label>
                        <select name="department" id="id_department" class="form-select" required>
                            <option value="">-- Select Department --</option>
                            {% for code, label in department_choices %}
                                <option value="{{ code }}" {% if code == registration.department %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Event Information Section -->
                <h2 class="section-header" style="margin-top: 40px;">
                    <i class="fas fa-calendar-alt"></i> Event Information
                </h2>

                <div class="form-group">
                    <label for="id_event" class="form-label">Event *</label>
                    <select name="event" id="id_event" class="form-select" required>
                        <option value="">-- Select Event --</option>
                        {% for event in events %}
                            <option value="{{ event.id }}" {% if event.id == registration.event.id %}selected{% endif %}>
                                {{ event.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Team Information Section -->
                <h2 class="section-header" style="margin-top: 40px;">
                    <i class="fas fa-users"></i> Team Information
                </h2>

                <div class="form-grid">
                    <!-- Team Name -->
                    <div class="form-group">
                        <label for="id_team_name" class="form-label">Team Name</label>
                        <input type="text" name="team_name" id="id_team_name" class="form-control" 
                               value="{{ registration.team_name }}" placeholder="Leave empty for solo event">
                    </div>

                    <!-- Team Members Count -->
                    <div class="form-group">
                        <label for="id_team_members" class="form-label">Team Members Count</label>
                        <input type="number" name="team_members" id="id_team_members" class="form-control" 
                               value="{{ registration.team_members }}" min="0" placeholder="Number of team members">
                    </div>
                </div>

                <!-- Toggle Switches -->
                <div class="form-grid">
                    <!-- Is Team Lead -->
                    <div class="form-switch-container">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="is_team_lead" 
                                   id="id_is_team_lead" {% if registration.is_team_lead %}checked{% endif %}>
                            <label class="form-check-label" for="id_is_team_lead">
                                Is Team Lead
                            </label>
                        </div>
                    </div>

                    <!-- Is Verified -->
                    <div class="form-switch-container">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="is_verified" 
                                   id="id_is_verified" {% if registration.is_verified %}checked{% endif %}>
                            <label class="form-check-label" for="id_is_verified">
                                Is Verified
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="info-box">
                    <div class="info-title">
                        <i class="fas fa-info-circle"></i> Important Information
                    </div>
                    <div class="info-content">
                        <p>• Fields marked with * are required</p>
                        <p>• Register number must be unique for each participant</p>
                        <p>• Team name should be left empty for solo events</p>
                        <p>• Verify registration status for confirmed participants</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <a href="{% url 'view_registrations' %}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Form validation
        const form = document.querySelector('form');
        const requiredFields = [
            'id_full_name',
            'id_register_number',
            'id_email',
            'id_year',
            'id_department',
            'id_event'
        ];

        form.addEventListener('submit', function(e) {
            let isValid = true;
            
            // Clear previous errors
            document.querySelectorAll('.error-list').forEach(el => el.remove());
            
            // Validate required fields
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && !field.value.trim()) {
                    isValid = false;
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error-list';
                    errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${field.labels[0].textContent} is required`;
                    field.parentNode.appendChild(errorDiv);
                    field.style.borderColor = 'hsl(var(--primary))';
                } else if (field) {
                    field.style.borderColor = '';
                }
            });

            // Validate email format
            const emailField = document.getElementById('id_email');
            if (emailField && emailField.value.trim()) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(emailField.value)) {
                    isValid = false;
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error-list';
                    errorDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Please enter a valid email address';
                    emailField.parentNode.appendChild(errorDiv);
                    emailField.style.borderColor = 'hsl(var(--primary))';
                }
            }

            // Validate phone number (if provided)
            const phoneField = document.getElementById('id_phone_number');
            if (phoneField && phoneField.value.trim()) {
                const phoneRegex = /^[\+\d\s\-]{10,15}$/;
                if (!phoneRegex.test(phoneField.value)) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error-list';
                    errorDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Please enter a valid phone number (10-15 digits)';
                    phoneField.parentNode.appendChild(errorDiv);
                    phoneField.style.borderColor = 'hsl(var(--primary))';
                }
            }

            if (!isValid) {
                e.preventDefault();
                // Scroll to first error
                const firstError = document.querySelector('.error-list');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });

        // Real-time validation for register number
        const regNumField = document.getElementById('id_register_number');
        if (regNumField) {
            regNumField.addEventListener('input', function() {
                if (this.value.trim().length < 8) {
                    this.style.borderColor = 'hsl(var(--primary))';
                } else {
                    this.style.borderColor = '';
                }
            });
        }

        // Auto-format phone number
        const phoneField = document.getElementById('id_phone_number');
        if (phoneField) {
            phoneField.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 0) {
                    value = '+91 ' + value;
                }
                e.target.value = value;
            });
        }
    });
</script>
{% endblock %}